# 編集ルール（スタイルガイド） v1 — 本ファイル専用ルール

適用対象: docs/qiita/centos_to_ubuntu_setup.md（このファイル専用）

目的:
- 可読性を上げつつ挙動（手順の意味・設定値）を変えない最小差分で整える。
- 別スレッドでも同じ品質で再現できるよう、編集の判断基準を明文化する。

適用スコープ:
- docs/qiita/centos_to_ubuntu_setup.md の運用メモ/手順書としての記述全般
- 表現の統一、注釈の追加、スクショ依存の削減、重複/矛盾の解消
- 非対象: 実行手順の本質変更、設定値の変更、依存方式の切替（検証が必要な改変）

[ルール]
1) 最小差分原則
   - 目的は「読みにくさ解消」。手順の意味・順序・値は変更しない。
   - 迷った場合は変更しない。必要なら注釈を足す形で補う。

2) コードブロックの表記
   - コンソール操作は言語タグを `bash:console` に統一する。
   - rootプロンプト `#` は使わず、一般ユーザー `$` で `sudo` を付与する表現に統一（例: `$ sudo systemctl restart apache2`）。
   - 設定ファイルや差分は用途に応じて `conf` / `diff` / `vim` などを用いる。
   - 実行結果ブロック（出力例）は内容を変えない。当時値は保持し、タグのみ統一する。

3) プレースホルダー表記
   - 機微情報や環境依存値は山括弧で統一する：`<your-username>`, `<your-email@example.com>`, `<IP>`, `<port>`。

4) 画像（スクショ）とテキストの優先順位
   - 「テキストが正」で「画像は補助」。画像でしか伝わらない情報は可能な限りテキストへ置換（例: curl によるHTTP確認）。
   - 既存画像は当面残置可だが、本文に「画像は補助」である旨を添える。

5) SSH/セキュリティ関連の表現
   - クライアントは Windows の PowerShell（OpenSSH）を前提に記述する。特定GUIツール名（例: TeraTerm）は使わない。
   - `known_hosts` 衝突は `ssh-keygen -R <IP>` を第一選択として提示。編集手段（`$env:USERPROFILE\\.ssh\\known_hosts`）も補足する。
   - 公開鍵ログインの権限要件を明記：`~/.ssh` は 700、`authorized_keys` は 600。
   - `ssh -T git@github.com` は任意の疎通確認であり、push の必須手順ではない旨を注記する。

6) Apache/mod_wsgi（APT方式に統一）
   - `libapache2-mod-wsgi-py3`（APT）を前提にする。`a2enmod wsgi` によりモジュール読み込みを中央管理。
   - サイト設定（`000-default.conf` 等）に `LoadModule wsgi_module ...` を書かない。理由（重複読み込みで `AH01574` 警告）をコメントで明記。
   - サイト固有の設定（`WSGIScriptAlias`, `WSGIDaemonProcess` など）は継続掲載。

7) HTTP→HTTPS の段階化
   - 手順順序は「HTTP確認 → 証明書取得 → HTTPS確認 → 最後にリダイレクト有効化」。
   - `# httpsの設定が済むまではコメントアウトしておく` は ServerName 直下（行番号目安は本文で）に配置し、完了後に有効化する diff を提示する。
   - 301 応答は「リダイレクト有効化後の正しい挙動」である旨を説明する。

8) Swap とシステム設定
   - Ubuntu 24.04 の swap 0MB については公式リンクで根拠を明示。
   - スワップ作成手順は `$ sudo` を基本とし、`swapon --show`, `free -h` による確認を併記。出力例の数値は当時値を維持。

9) ロケール
   - 目的は「UTF-8でエンコード例外を避ける」。`C.UTF-8` を推奨するが、`ja_JP.UTF-8` でも要件を満たす旨を注記し、運用方針で選択可能とする。

10) 権限（wsgi が読めること）
   - 典型の最小権限は「ディレクトリ 755／ファイル 644」。まとめ適用は“再設定”である旨を明記。
   - 実行属性が必要なスクリプトは個別に 755 を再付与する注意を記す。

11) 行番号と編集位置の示し方
   - Qiita依存の見出しではなく、本文に「対象ファイル」「行番号の目安」「アンカー（例: ServerName直下）」を明記する。
   - ディストリ差分でズレる可能性を注記しつつ、編集位置の目安を示す。

12) トラブルシュートの書き方
   - 各大項目の最後に「確認コマンド → 期待値」と「失敗時の切り分け（3点程度）」を箇条書きで簡潔に記す。

[運用原則]
- 実サーバの現状に合わせる（例: mod_wsgi は APT 方式／サイト設定に LoadModule を書かない）。
- 実測値・ログ・画像は当時の状態を維持（変更は注釈・表記統一のみ）。
- 検証が必要な変更は、別ブランチ／別Issueで扱う。

[チェックリスト（レビュー用）]
- コンソールタグが `bash:console` に統一されているか。
- `$ sudo ...` 表記で `#` が混入していないか。
- プレースホルダーが `<your-...>` に統一されているか。
- サイト設定に `LoadModule` を書いていないか（APT方式に一元化）。
- HTTP→HTTPS の順序とコメント位置が一貫しているか。
- `known_hosts` 衝突や公開鍵権限の注意が明記されているか。
- 主要ステップで確認コマンドと期待結果が併記されているか。
