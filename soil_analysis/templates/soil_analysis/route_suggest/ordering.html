{% extends "soil_analysis/base.html" %}
{% load static %}

{% block extra_css %}
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    <link rel="stylesheet" href="{% static 'soil_analysis/css/route_suggest/ordering.css' %}">
{% endblock %}

{% block extra_head %}
    <script src="https://polyfill.io/v3/polyfill.min.js?features=default"></script>

    <!-- drug and drop -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    <script src="{% static 'soil_analysis/js/route_suggest/drag-and-drop-script.js' %}"></script>

{% endblock %}

{% block content %}
    <div class="container ordering-container">
        <nav style="--bs-breadcrumb-divider: '>';" aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="{% url 'soil:home' %}">Home</a></li>
                <li class="breadcrumb-item"><a href="{% url 'soil:route_suggest_upload' %}">KML Upload</a></li>
                <li class="breadcrumb-item active" aria-current="page">Ordering</li>
            </ol>
        </nav>
        
        <div class="ordering-header">
            <h1><i class="fas fa-sort"></i> 訪問順序の設定</h1>
        </div>
        
        <div class="ordering-instruction">
            <div class="text-center">
                <i class="fas fa-info-circle"></i>
                <p><strong>ドラッグ＆ドロップ</strong>で訪問順序を並べ替えてください</p>
                <p class="instruction-detail">
                    一番上が<strong>始点</strong>、一番下が<strong>終点</strong>になります。中間地点は自動的に最適化されます。
                </p>
            </div>
        </div>
        
        <ul id="sortable-list">
            {% for land in object_list %}
                <li id="{{ land.id }}" class="list-group-item">
                    <span class="land-name">{{ land.name }}</span>
                    <span class="land-coord">{{ land.coord }}</span>
                </li>
            {% endfor %}
        </ul>
        
        <form id="orderForm" method="POST" action="{% url 'soil:route_suggest_ordering' %}">
            {% csrf_token %}
            <input type="hidden" id="orderData" name="order_data">
            <div class="submit-section">
                <button class="btn btn-submit" type="submit">
                    最適ルートを計算する<i class="fas fa-arrow-right"></i>
                </button>
            </div>
        </form>

        <script>
            $(function () {
                $('.list-group-item').hover(function () {
                    $(this).addClass('active');
                }, function () {
                    $(this).removeClass('active');
                });
            });
        </script>
    </div>
{% endblock %}
